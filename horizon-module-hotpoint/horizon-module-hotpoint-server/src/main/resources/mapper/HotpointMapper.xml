<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="org.horizon.module.hotpoint.dal.dataobject.nodes.KnowledgeNodesMapper">

    <resultMap id="BaseResultMap" type="org.horizon.module.knowledge.dal.dataobject.nodes.KnowledgeNodesDO">
        <id     column="id"          property="id"/>
        <result column="tenant_id"   property="tenantId"/>
        <result column="name"        property="name"/>
        <result column="parent_id"   property="parentId"/>
        <result column="remark"      property="remark"/>
        <result column="deleted"     property="deleted"/>
        <result column="creator"     property="creator"/>
        <result column="create_time" property="createTime"/>
        <result column="updater"     property="updater"/>
        <result column="update_time" property="updateTime"/>
    </resultMap>

    <sql id="Base_Column_List">
        id, tenant_id, name, parent_id, remark, deleted,
        creator, create_time, updater, update_time
    </sql>

    <!-- 统一 WHERE：默认排除已逻辑删除 -->
    <sql id="Where_If_Present">
        <where>
            <if test="req == null || req.includeDeleted == null || req.includeDeleted == false">
                AND deleted = FALSE
            </if>
            <if test="req != null">
                <if test="req.tenantId != null">
                    AND tenant_id = #{req.tenantId}
                </if>
                <if test="req.name != null and req.name != ''">
                    AND name ILIKE '%' || #{req.name} || '%'
                </if>
                <if test="req.parentId != null">
                    AND parent_id = #{req.parentId}
                </if>
                <if test="req.remark != null and req.remark != ''">
                    AND remark = #{req.remark}
                </if>
                <if test="req.deleted != null">
                    AND deleted = #{req.deleted}
                </if>
                <if test="req.createTime != null and req.createTime[0] != null and req.createTime[1] != null">
                    AND create_time BETWEEN #{req.createTime[0]} AND #{req.createTime[1]}
                </if>
            </if>
        </where>
    </sql>


</mapper>